<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Step 5: Sample ID Normalization - ALSU Pipeline</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .page-wrapper { display: flex; gap: 20px; max-width: 1400px; margin: 0 auto; }
        .sidebar { width: 250px; background: white; border-radius: 10px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); padding: 20px; height: fit-content; position: sticky; top: 20px; }
        .sidebar h3 { font-size: 1em; color: #333; margin-bottom: 15px; border-bottom: 2px solid #667eea; padding-bottom: 10px; }
        .roadmap-mini { display: flex; flex-direction: column; gap: 8px; }
        .roadmap-mini a { padding: 10px 12px; background: #f5f5f5; color: #333; text-decoration: none; border-radius: 5px; border-left: 4px solid transparent; transition: all 0.3s ease; font-size: 0.9em; }
        .roadmap-mini a:hover { background: #e3f2fd; border-left-color: #667eea; }
        .roadmap-mini a.current { background: #667eea; color: white; border-left-color: #764ba2; font-weight: 600; }
        .main-content { flex: 1; background: white; border-radius: 10px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); overflow: hidden; }
        .search-bar { background: #f5f5f5; padding: 15px 30px; border-bottom: 1px solid #ddd; }
        .search-bar input { width: 100%; max-width: 400px; padding: 12px 15px; border: 2px solid #ddd; border-radius: 5px; font-size: 1em; transition: border-color 0.3s ease; }
        .search-bar input:focus { outline: none; border-color: #667eea; }
        .search-results { display: none; padding: 20px 30px; background: #e3f2fd; border-bottom: 1px solid #ddd; }
        .search-results.active { display: block; }
        .search-results a { color: #1976d2; text-decoration: none; margin-right: 15px; }
        .search-results a:hover { text-decoration: underline; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; }
        .back-link { color: rgba(255,255,255,0.8); text-decoration: none; margin-bottom: 15px; display: inline-block; }
        .back-link:hover { color: white; }
        .header h1 { font-size: 2em; margin-bottom: 10px; }
        .header p { opacity: 0.9; }
        .step-badge { display: inline-block; background: rgba(255,255,255,0.2); padding: 5px 15px; border-radius: 20px; font-size: 0.9em; margin-top: 10px; }
        .content { padding: 30px; }
        .section-header { color: #667eea; font-size: 1.5em; margin: 25px 0 15px 0; padding-bottom: 10px; border-bottom: 2px solid #667eea; }
        .section-content { line-height: 1.8; color: #555; }
        .metric-table { width: 100%; border-collapse: collapse; margin: 20px 0; background: white; border-radius: 5px; overflow: hidden; }
        .metric-table th { background: #f5f5f5; padding: 12px; text-align: left; font-weight: 600; color: #667eea; border-bottom: 2px solid #ddd; }
        .metric-table td { padding: 12px; border-bottom: 1px solid #eee; }
        .metric-table tr:hover { background: #f9f9f9; }
        .code-block { background: #2d2d2d; color: #f8f8f2; padding: 20px; border-radius: 5px; overflow-x: auto; margin: 20px 0; font-family: 'Courier New', monospace; font-size: 0.9em; line-height: 1.5; }
        .info-box { background: #e3f2fd; border-left: 4px solid #1976d2; padding: 15px; margin: 15px 0; border-radius: 3px; }
        .warning-box { background: #fff3cd; border-left: 4px solid #ffc107; padding: 15px; margin: 15px 0; border-radius: 3px; }
        .success-box { background: #e8f5e9; border-left: 4px solid #4caf50; padding: 15px; margin: 15px 0; border-radius: 3px; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin: 20px 0; }
        .stat-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 5px; text-align: center; }
        .stat-value { font-size: 1.8em; font-weight: bold; }
        .stat-label { font-size: 0.85em; opacity: 0.9; margin-top: 5px; }
        .footer { background: #f5f5f5; padding: 20px 30px; text-align: center; color: #666; font-size: 0.9em; border-top: 1px solid #ddd; }
        @media (max-width: 1024px) { .page-wrapper { flex-direction: column; } .sidebar { width: 100%; position: relative; top: 0; } }
    </style>
</head>
<body>
    <div class="page-wrapper">
        <aside class="sidebar">
            <h3>Pipeline Steps</h3>
            <div class="roadmap-mini">
                <a href="step1.html">Step 1: Missingness</a>
                <a href="step2.html">Step 2: IBD Dedup</a>
                <a href="step3.html">Step 3: SNP QC</a>
                <a href="step4.html">Step 4: Imputation</a>
                <a href="step5.html" class="current">Step 5: ID Normalize</a>
                <a href="step6.html">Step 6: Final QC</a>
            </div>
        </aside>
        
        <div class="main-content">
            <div class="search-bar">
                <input type="text" id="searchInput" placeholder="Search across all steps..." onkeyup="searchAllSteps()">
            </div>
            <div class="search-results" id="searchResults"></div>
            
            <div class="container" style="margin: 0; border-radius: 0; box-shadow: none; max-width: 100%;">
                <div class="header">
                    <a href="../index.html" class="back-link">← Back to Roadmap</a>
                    <h1>Step 5: Sample ID Normalization (Homoglyph Fix)</h1>
                    <p>Fix Cyrillic character inconsistencies between PLINK and VCF data</p>
                    <span class="step-badge">✓ Completed — December 23, 2025</span>
                </div>
        
                <div class="content">
                    <div class="section">
                        <h2 class="section-header">1. Overview</h2>
                        <div class="section-content">
                            <p>
                                During VCF preparation and imputation, sample ID mismatches were discovered caused by 
                                Cyrillic homoglyphs (visually similar characters from different alphabets). This step identifies 
                                and corrects these inconsistencies to ensure sample tracking accuracy.
                            </p>
                            <div class="warning-box">
                                <strong>Issue Identified:</strong> Sample IDs containing Cyrillic characters (м, Х) were 
                                sometimes rendered as Latin equivalents (m, X), causing merge failures between PLINK and VCF data.
                            </div>
                            <h3 style="margin-top: 20px; color: #333;">Key Metrics</h3>
                            <div class="stats-grid">
                                <div class="stat-card">
                                    <div class="stat-value">1,098</div>
                                    <div class="stat-label">Samples Affected</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value">47</div>
                                    <div class="stat-label">IDs Corrected</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value">100%</div>
                                    <div class="stat-label">Sync Achieved</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="section">
                        <h2 class="section-header">2. Input Data</h2>
                        <div class="section-content">
                            <table class="metric-table">
                                <tr><th>Field</th><th>Value</th></tr>
                                <tr><td><strong>Files</strong></td><td>ConvSK_mind20_dedup.fam, chr*.dose.vcf.gz</td></tr>
                                <tr><td><strong>Location</strong></td><td>/data/processed/step2/, /data/imputed/</td></tr>
                                <tr><td><strong>Format</strong></td><td>PLINK FAM, VCF</td></tr>
                                <tr><td><strong>Issue</strong></td><td>Sample ID encoding inconsistencies</td></tr>
                                <tr><td><strong>Description</strong></td><td>PLINK and imputed VCF files with mismatched sample IDs</td></tr>
                            </table>
                        </div>
                    </div>
                    
                    <div class="section">
                        <h2 class="section-header">3. Output Data</h2>
                        <div class="section-content">
                            <table class="metric-table">
                                <tr><th>Field</th><th>Value</th></tr>
                                <tr><td><strong>Files</strong></td><td>ConvSK_mind20_dedup_ascii.bed/.bim/.fam</td></tr>
                                <tr><td><strong>Location</strong></td><td>/data/processed/step5/</td></tr>
                                <tr><td><strong>Format</strong></td><td>PLINK binary with normalized IDs</td></tr>
                                <tr><td><strong>Samples</strong></td><td>1,098 individuals (normalized)</td></tr>
                                <tr><td><strong>Variants</strong></td><td>654,027 SNPs</td></tr>
                                <tr><td><strong>Description</strong></td><td>PLINK data with ASCII-compatible sample IDs matching imputed VCF</td></tr>
                            </table>
                        </div>
                    </div>
                    
                    <div class="section">
                        <h2 class="section-header">4. Commands Executed</h2>
                        <div class="section-content">
                            <h3 style="color: #333; margin-top: 20px;">Step 1: Identify mismatches</h3>
                            <div class="code-block">comm -3 &lt;(awk '{print $2}' ConvSK_mind20_dedup.fam | sort) &lt;(bcftools query -l chr1.dose.vcf.gz | sort)</div>
                            
                            <h3 style="color: #333; margin-top: 20px;">Step 2: Create ID mapping</h3>
                            <div class="code-block">awk 'BEGIN{OFS="\t"} {new=$2; gsub(/м/,"m",new); gsub(/Х/,"X",new); if(new!=$2) print $1,$2,$1,new}' ConvSK_mind20_dedup.fam > update_ids.txt</div>
                            
                            <h3 style="color: #333; margin-top: 20px;">Step 3: Apply corrections</h3>
                            <div class="code-block">plink --bfile ConvSK_mind20_dedup --update-ids update_ids.txt --make-bed --out ConvSK_mind20_dedup_ascii</div>
                        </div>
                    </div>
                    
                    <div class="section">
                        <h2 class="section-header">5. Full Chronological Log</h2>
                        <div class="section-content">
                            <p style="margin-top: 20px; color: #999; font-size: 0.9em;">
                                See detailed daily log for <a href="../daily/2025-12-23.html" style="color: #667eea;">December 23, 2025</a> 
                                for complete homoglyph correction and ID verification steps.
                            </p>
                            <div class="success-box">
                                <strong>✓ Resolution:</strong> All 1,098 samples now have ASCII-compatible IDs. 
                                PLINK and VCF sample IDs successfully synchronized.
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="footer">
                    <a href="../index.html" style="color: #667eea; text-decoration: none;">← Back to Roadmap</a> | 
                    Last updated: January 2, 2026 | Step 5 of 6
                </div>
            </div>
        </div>
    </div>
    
    <script>
        function searchAllSteps() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            const resultsDiv = document.getElementById('searchResults');
            if (query.length === 0) { resultsDiv.classList.remove('active'); return; }
            const steps = [{name: 'Step 1', file: 'step1.html'}, {name: 'Step 2', file: 'step2.html'}, {name: 'Step 3', file: 'step3.html'}, {name: 'Step 4', file: 'step4.html'}, {name: 'Step 5', file: 'step5.html', content: document.body.innerText}, {name: 'Step 6', file: 'step6.html'}];
            const results = [];
            if (steps[4].content.toLowerCase().includes(query)) { results.push(`<a href="step5.html">${steps[4].name}: Found match</a>`); }
            if (results.length > 0) { resultsDiv.innerHTML = 'Found in: ' + results.join(' | '); resultsDiv.classList.add('active'); } else { resultsDiv.innerHTML = 'No results found'; resultsDiv.classList.add('active'); }
        }
    </script>
</body>
</html>
