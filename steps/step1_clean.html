<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Step 1: Sample Missingness Filter - ALSU Pipeline</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .page-wrapper {
            display: flex;
            gap: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .sidebar {
            width: 250px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            padding: 20px;
            height: fit-content;
            position: sticky;
            top: 20px;
        }
        
        .sidebar h3 {
            font-size: 1em;
            color: #333;
            margin-bottom: 15px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        
        .roadmap-mini {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .roadmap-mini a {
            padding: 10px 12px;
            background: #f5f5f5;
            color: #333;
            text-decoration: none;
            border-radius: 5px;
            border-left: 4px solid transparent;
            transition: all 0.3s ease;
            font-size: 0.9em;
        }
        
        .roadmap-mini a:hover {
            background: #e3f2fd;
            border-left-color: #667eea;
        }
        
        .roadmap-mini a.current {
            background: #667eea;
            color: white;
            border-left-color: #764ba2;
            font-weight: 600;
        }
        
        .main-content {
            flex: 1;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        
        .search-bar {
            background: #f5f5f5;
            padding: 15px 30px;
            border-bottom: 1px solid #ddd;
        }
        
        .search-bar input {
            width: 100%;
            max-width: 400px;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 1em;
            transition: border-color 0.3s ease;
        }
        
        .search-bar input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .search-results {
            display: none;
            padding: 20px 30px;
            background: #e3f2fd;
            border-bottom: 1px solid #ddd;
        }
        
        .search-results.active {
            display: block;
        }
        
        .search-results a {
            color: #1976d2;
            text-decoration: none;
            margin-right: 15px;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
        }
        
        .back-link {
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            margin-bottom: 15px;
            display: inline-block;
        }
        
        .back-link:hover {
            color: white;
        }
        
        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.9;
        }
        
        .step-badge {
            display: inline-block;
            background: rgba(255,255,255,0.2);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            margin-top: 10px;
        }
        
        .content {
            padding: 30px;
        }
        
        .section {
            margin-bottom: 40px;
        }
        
        .section-header {
            color: #667eea;
            font-size: 1.5em;
            margin: 0 0 20px 0;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }
        
        .section-content {
            line-height: 1.8;
            color: #555;
        }
        
        .metric-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 5px;
            overflow: hidden;
            border: 1px solid #ddd;
        }
        
        .metric-table th {
            background: #667eea;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }
        
        .metric-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
        }
        
        .metric-table tr:last-child td {
            border-bottom: none;
        }
        
        .metric-table tr:hover {
            background: #f9f9f9;
        }
        
        .code-block {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 5px;
            overflow-x: auto;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            line-height: 1.6;
        }
        
        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #1976d2;
            padding: 15px;
            margin: 15px 0;
            border-radius: 3px;
        }
        
        .success-box {
            background: #e8f5e9;
            border-left: 4px solid #2e7d32;
            padding: 15px;
            margin: 15px 0;
            border-radius: 3px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 5px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.8em;
            font-weight: bold;
        }
        
        .stat-label {
            font-size: 0.85em;
            opacity: 0.9;
            margin-top: 5px;
        }
        
        .timeline {
            position: relative;
            padding: 20px 0;
        }
        
        .timeline-item {
            padding-left: 30px;
            margin: 15px 0;
            position: relative;
        }
        
        .timeline-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 5px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #667eea;
        }
        
        .timeline-time {
            color: #667eea;
            font-weight: bold;
            font-size: 0.9em;
        }
        
        .timeline-description {
            color: #666;
            margin-top: 3px;
        }
        
        .footer {
            background: #f5f5f5;
            padding: 20px 30px;
            text-align: center;
            color: #666;
            font-size: 0.9em;
            border-top: 1px solid #ddd;
        }
        
        @media (max-width: 1024px) {
            .page-wrapper {
                flex-direction: column;
            }
            .sidebar {
                width: 100%;
                position: relative;
                top: 0;
            }
        }
    </style>
</head>
<body>
    <div class="page-wrapper">
        <!-- LEFT SIDEBAR -->
        <aside class="sidebar">
            <h3>Pipeline Steps</h3>
            <div class="roadmap-mini">
                <a href="step1.html" class="current">Step 1: Missingness</a>
                <a href="step2.html">Step 2: IBD Dedup</a>
                <a href="step3.html">Step 3: SNP QC</a>
                <a href="step4.html">Step 4: Imputation</a>
                <a href="step5.html">Step 5: ID Normalize</a>
                <a href="step6.html">Step 6: Final QC</a>
            </div>
        </aside>
        
        <!-- MAIN CONTENT -->
        <div class="main-content">
            <div class="search-bar">
                <input type="text" id="searchInput" placeholder="Search across all steps..." onkeyup="searchAllSteps()">
            </div>
            <div class="search-results" id="searchResults"></div>
            
            <div class="header">
                <a href="../index.html" class="back-link">← Back to Roadmap</a>
                <h1>Step 1: Sample Missingness Filter</h1>
                <p>Remove samples with excessive missing genotypes</p>
                <span class="step-badge">✓ Completed — December 15, 2025</span>
            </div>
            
            <div class="content">
                <!-- 1. OVERVIEW -->
                <div class="section">
                    <h2 class="section-header">1. Overview</h2>
                    <div class="section-content">
                        <p>
                            The first step in the pipeline removes samples with excessive missing genotype data. 
                            This is a standard quality control procedure that ensures downstream analyses use samples with sufficient 
                            genotyping coverage.
                        </p>
                        
                        <div class="info-box">
                            <strong>Rationale:</strong> Samples with high missingness rates indicate technical issues during genotyping 
                            (e.g., DNA degradation, low DNA concentration, array technical failures). Removing these samples improves 
                            data quality and prevents artifacts in downstream analyses.
                        </div>
                        
                        <h3 style="margin-top: 20px; color: #333;">Key Metrics</h3>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-value">1,247</div>
                                <div class="stat-label">Starting Samples</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">92</div>
                                <div class="stat-label">Samples Removed</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">1,155</div>
                                <div class="stat-label">Final Samples</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">7.4%</div>
                                <div class="stat-label">Removal Rate</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 2. INPUT DATA -->
                <div class="section">
                    <h2 class="section-header">2. Input Data</h2>
                    <div class="section-content">
                        <table class="metric-table">
                            <tr>
                                <th>Field</th>
                                <th>Value</th>
                            </tr>
                            <tr>
                                <td><strong>Files</strong></td>
                                <td>ConvSK_raw.bed, ConvSK_raw.bim, ConvSK_raw.fam</td>
                            </tr>
                            <tr>
                                <td><strong>Location</strong></td>
                                <td>/data/genotypes/</td>
                            </tr>
                            <tr>
                                <td><strong>Format</strong></td>
                                <td>PLINK binary (.bed/.bim/.fam)</td>
                            </tr>
                            <tr>
                                <td><strong>Samples</strong></td>
                                <td>1,247</td>
                            </tr>
                            <tr>
                                <td><strong>Variants</strong></td>
                                <td>654,027 SNPs</td>
                            </tr>
                            <tr>
                                <td><strong>Description</strong></td>
                                <td>Raw genotype data from Illumina genotyping array</td>
                            </tr>
                        </table>
                    </div>
                </div>
                
                <!-- 3. OUTPUT DATA -->
                <div class="section">
                    <h2 class="section-header">3. Output Data</h2>
                    <div class="section-content">
                        <table class="metric-table">
                            <tr>
                                <th>Field</th>
                                <th>Value</th>
                            </tr>
                            <tr>
                                <td><strong>Files</strong></td>
                                <td>ConvSK_mind20.bed, ConvSK_mind20.bim, ConvSK_mind20.fam</td>
                            </tr>
                            <tr>
                                <td><strong>Location</strong></td>
                                <td>/data/processed/step1/</td>
                            </tr>
                            <tr>
                                <td><strong>Format</strong></td>
                                <td>PLINK binary (.bed/.bim/.fam)</td>
                            </tr>
                            <tr>
                                <td><strong>Samples</strong></td>
                                <td>1,155 (92 removed)</td>
                            </tr>
                            <tr>
                                <td><strong>Variants</strong></td>
                                <td>654,027 SNPs (unchanged)</td>
                            </tr>
                            <tr>
                                <td><strong>Description</strong></td>
                                <td>Quality-filtered genotypes with high-missingness samples removed (F_MISS ≤ 0.20)</td>
                            </tr>
                        </table>
                        <div class="success-box">
                            <strong>✓ Quality Check:</strong> All remaining samples have F_MISS ≤ 0.20, meeting quality threshold
                        </div>
                    </div>
                </div>
                
                <!-- 4. COMMANDS EXECUTED -->
                <div class="section">
                    <h2 class="section-header">4. Commands Executed</h2>
                    <div class="section-content">
                        <h3 style="color: #333; margin-top: 0;">Step 1: Calculate per-sample missingness</h3>
                        <div class="code-block">$ plink --bfile ConvSK_raw --missing --out ConvSK_raw_miss</div>
                        
                        <h3 style="color: #333; margin-top: 20px;">Step 2: Extract samples with F_MISS > 0.20</h3>
                        <div class="code-block">$ awk 'NR>1 && $6+0 > 0.20 {print $1"\t"$2}' \
  ConvSK_raw_miss.imiss > remove_miss20.txt</div>
                        
                        <h3 style="color: #333; margin-top: 20px;">Step 3: Verify removal list size</h3>
                        <div class="code-block">$ wc -l remove_miss20.txt
92 remove_miss20.txt</div>
                        
                        <h3 style="color: #333; margin-top: 20px;">Step 4: Remove samples from dataset</h3>
                        <div class="code-block">$ plink --bfile ConvSK_raw \
  --remove remove_miss20.txt \
  --make-bed \
  --out ConvSK_mind20

PLINK v1.90b6.21 64-bit (2 May 2018)
Options in effect:
  --bfile ConvSK_raw
  --remove remove_miss20.txt
  --make-bed
  --out ConvSK_mind20

Reading map file from [ ConvSK_raw.bim ] ... 654027 markers loaded.
Reading fam file from [ ConvSK_raw.fam ] ... 1247 individuals loaded.
--remove: 92 people removed, 1155 remaining.

Writing pedigree information to [ ConvSK_mind20.fam ].
Writing map (bim) file to [ ConvSK_mind20.bim ].
Writing bed file to [ ConvSK_mind20.bed ].

Run complete. Total elapsed time: 2.45 seconds.</div>
                    </div>
                </div>
                
                <!-- 5. CHRONOLOGICAL LOG -->
                <div class="section">
                    <h2 class="section-header">5. Full Chronological Log</h2>
                    <div class="section-content">
                        <div class="timeline">
                            <div class="timeline-item">
                                <div class="timeline-time">2025-12-15 09:15</div>
                                <div class="timeline-description">
                                    <strong>Initiated missingness analysis</strong><br>
                                    Computed per-individual missingness with PLINK --missing command
                                </div>
                            </div>
                            
                            <div class="timeline-item">
                                <div class="timeline-time">2025-12-15 09:18</div>
                                <div class="timeline-description">
                                    <strong>Identified outlier samples</strong><br>
                                    Found 92 samples with F_MISS > 0.20 threshold exceeded
                                </div>
                            </div>
                            
                            <div class="timeline-item">
                                <div class="timeline-time">2025-12-15 09:22</div>
                                <div class="timeline-description">
                                    <strong>Generated removal list</strong><br>
                                    Created remove_miss20.txt with FID/IID pairs for 92 samples
                                </div>
                            </div>
                            
                            <div class="timeline-item">
                                <div class="timeline-time">2025-12-15 09:28</div>
                                <div class="timeline-description">
                                    <strong>Executed PLINK removal</strong><br>
                                    Removed 92 samples from dataset: 1,247 → 1,155 samples
                                </div>
                            </div>
                            
                            <div class="timeline-item">
                                <div class="timeline-time">2025-12-15 09:35</div>
                                <div class="timeline-description">
                                    <strong>Validation completed</strong><br>
                                    Generated binary PLINK output: ConvSK_mind20.{bed,bim,fam}
                                </div>
                            </div>
                            
                            <div class="timeline-item">
                                <div class="timeline-time">2025-12-15 09:40</div>
                                <div class="timeline-description">
                                    <strong>Step 1 completed</strong><br>
                                    Dataset ready for next step: IBD deduplication analysis
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="footer">
                <a href="../index.html" style="color: #667eea; text-decoration: none;">← Back to Roadmap</a> | 
                Last updated: January 2, 2026 | Step 1 of 6
            </div>
        </div>
    </div>
    
    <script>
        function searchAllSteps() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            const resultsDiv = document.getElementById('searchResults');
            
            if (query.length === 0) {
                resultsDiv.classList.remove('active');
                return;
            }
            
            const content = document.body.innerText.toLowerCase();
            if (content.includes(query)) {
                resultsDiv.innerHTML = 'Found: "' + query + '" in this page';
                resultsDiv.classList.add('active');
            } else {
                resultsDiv.innerHTML = 'No results found for "' + query + '"';
                resultsDiv.classList.add('active');
            }
        }
    </script>
</body>
</html>
