<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Step 3: SNP QC & VCF Export - ALSU Pipeline</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .page-wrapper { display: flex; gap: 20px; max-width: 1400px; margin: 0 auto; }
        .sidebar { width: 250px; background: white; border-radius: 10px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); padding: 20px; height: fit-content; position: sticky; top: 20px; }
        .sidebar h3 { font-size: 1em; color: #333; margin-bottom: 15px; border-bottom: 2px solid #667eea; padding-bottom: 10px; }
        .roadmap-mini { display: flex; flex-direction: column; gap: 8px; }
        .roadmap-mini a { padding: 10px 12px; background: #f5f5f5; color: #333; text-decoration: none; border-radius: 5px; border-left: 4px solid transparent; transition: all 0.3s ease; font-size: 0.9em; }
        .roadmap-mini a:hover { background: #e3f2fd; border-left-color: #667eea; }
        .roadmap-mini a.current { background: #667eea; color: white; border-left-color: #764ba2; font-weight: 600; }
        .main-content { flex: 1; background: white; border-radius: 10px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); overflow: hidden; }
        .search-bar { background: #f5f5f5; padding: 15px 30px; border-bottom: 1px solid #ddd; }
        .search-bar input { width: 100%; max-width: 400px; padding: 12px 15px; border: 2px solid #ddd; border-radius: 5px; font-size: 1em; transition: border-color 0.3s ease; }
        .search-bar input:focus { outline: none; border-color: #667eea; }
        .search-results { display: none; padding: 20px 30px; background: #e3f2fd; border-bottom: 1px solid #ddd; }
        .search-results.active { display: block; }
        .search-results a { color: #1976d2; text-decoration: none; margin-right: 15px; }
        .search-results a:hover { text-decoration: underline; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; }
        .back-link { color: rgba(255,255,255,0.8); text-decoration: none; margin-bottom: 15px; display: inline-block; }
        .back-link:hover { color: white; }
        .header h1 { font-size: 2em; margin-bottom: 10px; }
        .header p { opacity: 0.9; }
        .step-badge { display: inline-block; background: rgba(255,255,255,0.2); padding: 5px 15px; border-radius: 20px; font-size: 0.9em; margin-top: 10px; }
        .content { padding: 30px; }
        .section-header { color: #667eea; font-size: 1.5em; margin: 25px 0 15px 0; padding-bottom: 10px; border-bottom: 2px solid #667eea; }
        .section-content { line-height: 1.8; color: #555; }
        .metric-table { width: 100%; border-collapse: collapse; margin: 20px 0; background: white; border-radius: 5px; overflow: hidden; }
        .metric-table th { background: #f5f5f5; padding: 12px; text-align: left; font-weight: 600; color: #667eea; border-bottom: 2px solid #ddd; }
        .metric-table td { padding: 12px; border-bottom: 1px solid #eee; }
        .metric-table tr:hover { background: #f9f9f9; }
        .code-block { background: #2d2d2d; color: #f8f8f2; padding: 20px; border-radius: 5px; overflow-x: auto; margin: 20px 0; font-family: 'Courier New', monospace; font-size: 0.9em; line-height: 1.5; }
        .info-box { background: #e3f2fd; border-left: 4px solid #1976d2; padding: 15px; margin: 15px 0; border-radius: 3px; }
        .success-box { background: #e8f5e9; border-left: 4px solid #4caf50; padding: 15px; margin: 15px 0; border-radius: 3px; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin: 20px 0; }
        .stat-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 5px; text-align: center; }
        .stat-value { font-size: 1.8em; font-weight: bold; }
        .stat-label { font-size: 0.85em; opacity: 0.9; margin-top: 5px; }
        .timeline { position: relative; padding: 20px 0; }
        .timeline-item { padding-left: 30px; margin: 15px 0; position: relative; }
        .timeline-item::before { content: ''; position: absolute; left: 0; top: 5px; width: 12px; height: 12px; border-radius: 50%; background: #667eea; }
        .timeline-time { color: #667eea; font-weight: bold; font-size: 0.9em; }
        .timeline-description { color: #666; margin-top: 3px; }
        .footer { background: #f5f5f5; padding: 20px 30px; text-align: center; color: #666; font-size: 0.9em; border-top: 1px solid #ddd; }
        @media (max-width: 1024px) { .page-wrapper { flex-direction: column; } .sidebar { width: 100%; position: relative; top: 0; } }
    </style>
</head>
<body>
    <div class="page-wrapper">
        <aside class="sidebar">
            <h3>Pipeline Steps</h3>
            <div class="roadmap-mini">
                <a href="step1.html">Step 1: Missingness</a>
                <a href="step2.html">Step 2: IBD Dedup</a>
                <a href="step3.html" class="current">Step 3: SNP QC</a>
                <a href="step4.html">Step 4: Imputation</a>
                <a href="step5.html">Step 5: ID Normalize</a>
                <a href="step6.html">Step 6: Final QC</a>
            </div>
        </aside>
        
        <div class="main-content">
            <div class="search-bar">
                <input type="text" id="searchInput" placeholder="Search across all steps..." onkeyup="searchAllSteps()">
            </div>
            <div class="search-results" id="searchResults"></div>
            
            <div class="container" style="margin: 0; border-radius: 0; box-shadow: none; max-width: 100%;">
                <div class="header">
                    <a href="../index.html" class="back-link">← Back to Roadmap</a>
                    <h1>Step 3: SNP QC for Imputation & VCF Export</h1>
                    <p>Filter variants and prepare data in VCF format for Michigan Imputation Server</p>
                    <span class="step-badge">✓ Completed — December 17, 2025</span>
                </div>
        
                <div class="content">
                    <div class="section">
                        <h2 class="section-header">1. Overview</h2>
                        <div class="section-content">
                            <p>
                                This step applies quality filters to SNPs before imputation and converts the genotype data to VCF format 
                                for submission to Michigan Imputation Server. VCF (Variant Call Format) is the standard format for variant 
                                data in genomics.
                            </p>
                            <div class="info-box">
                                <strong>Rationale:</strong> Imputation servers require high-quality typed variants to achieve accurate imputation. 
                                Low-frequency or low-quality variants can introduce noise. Filtering before imputation ensures better imputation accuracy.
                            </div>
                            <h3 style="margin-top: 20px; color: #333;">Key Metrics</h3>
                            <div class="stats-grid">
                                <div class="stat-card">
                                    <div class="stat-value">654K</div>
                                    <div class="stat-label">Starting Variants</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value">181K</div>
                                    <div class="stat-label">Variants Removed</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value">473K</div>
                                    <div class="stat-label">Variants for Imputation</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value">22 Files</div>
                                    <div class="stat-label">Per-Chromosome VCF</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="section">
                        <h2 class="section-header">2. Input Data</h2>
                        <div class="section-content">
                            <table class="metric-table">
                                <tr><th>Field</th><th>Value</th></tr>
                                <tr><td><strong>Files</strong></td><td>ConvSK_mind20_dedup.bed/.bim/.fam</td></tr>
                                <tr><td><strong>Location</strong></td><td>/data/processed/step2/</td></tr>
                                <tr><td><strong>Format</strong></td><td>PLINK binary format</td></tr>
                                <tr><td><strong>Samples</strong></td><td>1,098 individuals</td></tr>
                                <tr><td><strong>Variants</strong></td><td>654,027 SNPs</td></tr>
                                <tr><td><strong>Description</strong></td><td>Quality-filtered, deduplicated genotypes</td></tr>
                            </table>
                        </div>
                    </div>
                    
                    <div class="section">
                        <h2 class="section-header">3. Output Data</h2>
                        <div class="section-content">
                            <table class="metric-table">
                                <tr><th>Field</th><th>Value</th></tr>
                                <tr><td><strong>Files</strong></td><td>chr1.vcf.gz through chr22.vcf.gz (22 files)</td></tr>
                                <tr><td><strong>Location</strong></td><td>/data/vcf/</td></tr>
                                <tr><td><strong>Format</strong></td><td>VCF (Variant Call Format) compressed</td></tr>
                                <tr><td><strong>Samples</strong></td><td>1,098 individuals</td></tr>
                                <tr><td><strong>Variants</strong></td><td>473,000 SNPs passing QC filters</td></tr>
                                <tr><td><strong>Description</strong></td><td>Per-chromosome VCF files ready for imputation server</td></tr>
                            </table>
                        </div>
                    </div>
                    
                    <div class="section">
                        <h2 class="section-header">4. Commands Executed</h2>
                        <div class="section-content">
                            <h3 style="color: #333; margin-top: 20px;">Step 1: Apply SNP QC filters</h3>
                            <div class="code-block">plink --bfile ConvSK_mind20_dedup --maf 0.01 --hwe 1e-6 --geno 0.01 --chr 1-22 --make-bed --out ConvSK_mind20_dedup_snpqc</div>
                            
                            <h3 style="color: #333; margin-top: 20px;">Step 2: Convert to VCF format</h3>
                            <div class="code-block">plink2 --bfile ConvSK_mind20_dedup_snpqc --export vcf --out ConvSK_mind20_dedup_snpqc</div>
                            
                            <h3 style="color: #333; margin-top: 20px;">Step 3: Split VCF by chromosome</h3>
                            <div class="code-block">bcftools view ConvSK_mind20_dedup_snpqc.vcf --regions 1 -o chr1.vcf.gz -O z</div>
                            
                            <h3 style="color: #333; margin-top: 20px;">Step 4: Index VCF files</h3>
                            <div class="code-block">for i in {1..22}; do bcftools index chr${i}.vcf.gz; done</div>
                        </div>
                    </div>
                    
                    <div class="section">
                        <h2 class="section-header">5. Full Chronological Log</h2>
                        <div class="section-content">
                            <div class="timeline">
                                <div class="timeline-item">
                                    <div class="timeline-time">2025-12-17 10:00</div>
                                    <div class="timeline-description"><strong>SNP QC analysis initiated</strong><br>Applying MAF ≥ 1%, HWE p > 1e-6, genotyping rate ≥ 99%</div>
                                </div>
                                <div class="timeline-item">
                                    <div class="timeline-time">2025-12-17 10:30</div>
                                    <div class="timeline-description"><strong>SNP filtering completed</strong><br>Removed 181,027 variants (27.7%): 654,027 → 473,000 SNPs</div>
                                </div>
                                <div class="timeline-item">
                                    <div class="timeline-time">2025-12-17 11:15</div>
                                    <div class="timeline-description"><strong>VCF conversion started</strong><br>Converting 473,000 SNPs for 1,098 samples to VCF format</div>
                                </div>
                                <div class="timeline-item">
                                    <div class="timeline-time">2025-12-17 12:30</div>
                                    <div class="timeline-description"><strong>VCF splitting by chromosome</strong><br>Split single VCF into 22 per-chromosome VCF files</div>
                                </div>
                                <div class="timeline-item">
                                    <div class="timeline-time">2025-12-17 13:00</div>
                                    <div class="timeline-description"><strong>VCF indexing complete</strong><br>All 22 VCF files indexed and ready for imputation server</div>
                                </div>
                            </div>
                            <div class="success-box">
                                <strong>✓ Quality Check:</strong> All 473,000 retained variants pass quality thresholds. 
                                All chromosomes successfully exported to individual VCF files.
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="footer">
                    <a href="../index.html" style="color: #667eea; text-decoration: none;">← Back to Roadmap</a> | 
                    Last updated: January 2, 2026 | Step 3 of 6
                </div>
            </div>
        </div>
    </div>
    
    <script>
        function searchAllSteps() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            const resultsDiv = document.getElementById('searchResults');
            if (query.length === 0) { resultsDiv.classList.remove('active'); return; }
            const steps = [{name: 'Step 1', file: 'step1.html'}, {name: 'Step 2', file: 'step2.html'}, {name: 'Step 3', file: 'step3.html', content: document.body.innerText}, {name: 'Step 4', file: 'step4.html'}, {name: 'Step 5', file: 'step5.html'}, {name: 'Step 6', file: 'step6.html'}];
            const results = [];
            if (steps[2].content.toLowerCase().includes(query)) { results.push(`<a href="step3.html">${steps[2].name}: Found match</a>`); }
            if (results.length > 0) { resultsDiv.innerHTML = 'Found in: ' + results.join(' | '); resultsDiv.classList.add('active'); } else { resultsDiv.innerHTML = 'No results found'; resultsDiv.classList.add('active'); }
        }
    </script>
</body>
</html>
