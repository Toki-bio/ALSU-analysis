<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Step 3: SNP QC - ALSU Pipeline</title>
    <style>
        * {margin: 0; padding: 0; box-sizing: border-box;}
        body {font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #4a4a4a 0%, #2a2a2a 100%); min-height: 100vh; padding: 20px;}
        .page-wrapper {display: flex; gap: 20px; max-width: 1400px; margin: 0 auto;}
        .sidebar {width: 250px; background: white; border-radius: 10px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); padding: 20px; height: fit-content; position: sticky; top: 20px;}
        .sidebar h3 {font-size: 1em; color: #333; margin-bottom: 15px; border-bottom: 2px solid #888; padding-bottom: 10px;}
        .roadmap-mini {display: flex; flex-direction: column; gap: 8px;}
        .roadmap-mini a {padding: 10px 12px; background: #f5f5f5; color: #333; text-decoration: none; border-radius: 5px; border-left: 4px solid transparent; transition: all 0.3s ease; font-size: 0.9em;}
        .roadmap-mini a:hover {background: #f0f0f0; border-left-color: #666;}
        .roadmap-mini a.current {background: #555; color: white; border-left-color: #333; font-weight: 600;}
        .main-content {flex: 1; background: white; border-radius: 10px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); overflow: hidden;}
        .search-bar {background: #f5f5f5; padding: 15px 30px; border-bottom: 1px solid #ddd;}
        .search-bar input {width: 100%; max-width: 400px; padding: 12px 15px; border: 2px solid #ddd; border-radius: 5px; font-size: 1em; transition: border-color 0.3s ease;}
        .search-bar input:focus {outline: none; border-color: #888;}
        .search-results {display: none; padding: 20px 30px; background: #f5f5f5; border-bottom: 1px solid #ddd;}
        .search-results.active {display: block;}
        .header {background: linear-gradient(135deg, #3a3a3a 0%, #1a1a1a 100%); color: white; padding: 30px;}
        .back-link {color: rgba(255,255,255,0.8); text-decoration: none; margin-bottom: 15px; display: inline-block;}
        .back-link:hover {color: white;}
        .header h1 {font-size: 2em; margin-bottom: 10px;}
        .header p {opacity: 0.9;}
        .step-badge {display: inline-block; background: rgba(255,255,255,0.2); padding: 5px 15px; border-radius: 20px; font-size: 0.9em; margin-top: 10px;}
        .content {padding: 30px;}
        .section {margin-bottom: 40px;}
        .section-header {color: #333; font-size: 1.5em; margin: 0 0 20px 0; padding-bottom: 10px; border-bottom: 2px solid #999;}
        .section-content {line-height: 1.8; color: #555;}
        .metric-table {width: 100%; border-collapse: collapse; margin: 10px 0; background: white; border-radius: 5px; overflow: hidden; border: 1px solid #ddd;}
        .metric-table th {background: #f5f5f5; color: #333; padding: 8px; text-align: left; font-weight: 600; font-size: 0.95em; border-bottom: 2px solid #ddd;}
        .metric-table td {padding: 6px 8px; border-bottom: 1px solid #eee; font-size: 0.9em; line-height: 1.3;}
        .metric-table tr:last-child td {border-bottom: none;}
        .metric-table tr:hover {background: #f9f9f9;}
        .code-block {background: #2d2d2d; color: #f8f8f2; padding: 20px; border-radius: 5px; overflow-x: auto; margin: 20px 0; font-family: 'Courier New', monospace; font-size: 0.9em; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word;}
        .info-box {background: #f0f0f0; border-left: 4px solid #666; padding: 15px; margin: 15px 0; border-radius: 3px;}
        .success-box {background: #f5f5f5; border-left: 4px solid #555; padding: 15px; margin: 15px 0; border-radius: 3px;}
        .stats-grid {display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 10px; margin: 20px 0;}
        .stat-card {background: linear-gradient(135deg, #5a5a5a 0%, #3a3a3a 100%); color: white; padding: 12px; border-radius: 5px; text-align: center;}
        .stat-value {font-size: 1.3em; font-weight: bold;}
        .stat-label {font-size: 0.75em; opacity: 0.9; margin-top: 3px;}
        .timeline {position: relative; padding: 20px 0;}
        .timeline-item {padding-left: 30px; margin: 15px 0; position: relative;}
        .timeline-item::before {content: ''; position: absolute; left: 0; top: 5px; width: 12px; height: 12px; border-radius: 50%; background: #666;}
        .timeline-time {color: #555; font-weight: bold; font-size: 0.9em;}
        .timeline-description {color: #666; margin-top: 3px;}
        .footer {background: #f5f5f5; padding: 20px 30px; text-align: center; color: #666; font-size: 0.9em; border-top: 1px solid #ddd;}
        @media (max-width: 1024px) {.page-wrapper {flex-direction: column;} .sidebar {width: 100%; position: relative; top: 0;}}
        .editable-text {cursor: text; position: relative;}
        .editable-text:hover {background-color: rgba(200, 200, 200, 0.2); border-radius: 3px;}
        .editable-text[contenteditable="true"] {background-color: #fffacd; border: 2px solid #333; padding: 2px 4px; border-radius: 3px; outline: none;}
    </style>
</head>
<body>
    <div class="page-wrapper">
        <aside class="sidebar">
            <h3>Pipeline Steps</h3>
            <div class="roadmap-mini">
                <a href="step1.html">Step 1: Missingness</a>
                <a href="step2.html">Step 2: IBD Dedup</a>
                <a href="step3.html" class="current">Step 3: SNP QC</a>
                <a href="step4.html">Step 4: Imputation</a>
                <a href="step5.html">Step 5: ID Normalize</a>
                <a href="step6.html">Step 6: Final QC</a>
                <a href="step7.html">Step 7: PCA Analysis</a>
                <a href="step8.html">Step 8: Global PCA</a>
                <a href="step9.html">Step 9: Fst Analysis</a>
            </div>
        </aside>
        
        <div class="main-content">
            <div class="search-bar">
                <input type="text" id="searchInput" placeholder="Search across all steps..." onkeyup="searchAllSteps()">
            </div>
            <div class="search-results" id="searchResults"></div>
            
            <div class="header">
                <a href="../index.html" class="back-link">‚Üê Back to Roadmap</a>
                <h1>Step 3: SNP QC & VCF Export</h1>
                <p>Filter variants and prepare data in VCF format for imputation</p>
                <span class="step-badge">‚úì Completed ‚Äî December 17, 2025</span>
            </div>
            
            <div class="content">
                <div class="section">
                    <h2 class="section-header">1. Overview</h2>
                    <div class="section-content">
                        <p>
                            This step applies quality filters to SNPs before imputation and converts genotype data to VCF format
                            for submission to Michigan Imputation Server. VCF (Variant Call Format) is the standard format for variant data in genomics.
                        </p>
                        <div class="info-box">
                            <strong>Rationale:</strong> Imputation servers require high-quality typed variants for accurate imputation. 
                            Low-frequency or low-quality variants introduce noise. Filtering ensures better downstream accuracy.
                        </div>
                        <h3 style="margin-top: 20px; color: #333;">Key Metrics</h3>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-value">654,027</div>
                                <div class="stat-label">Starting Variants</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">181,564</div>
                                <div class="stat-label">Removed</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">472,463</div>
                                <div class="stat-label">For Imputation</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">72.2%</div>
                                <div class="stat-label">Retention Rate</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="section">
                    <h2 class="section-header">2. Input Data</h2>
                    <div class="section-content">
                        <table class="metric-table">

                            <tr><td><strong>Files</strong></td><td>ConvSK_mind20_dedup.bed, .bim, .fam</td></tr>
                            <tr><td><strong>Location</strong></td><td>/staging/ALSU-analysis/winter2025/</td></tr>
                            <tr><td><strong>Samples</strong></td><td>1,098</td></tr>
                            <tr><td><strong>Variants</strong></td><td>654,027 SNPs</td></tr>
                            <tr><td><strong>Description</strong></td><td>IBD-deduplicated genotypes ready for SNP QC</td></tr>
                        </table>
                    </div>
                </div>
                
                <div class="section">
                    <h2 class="section-header">3. Output Data</h2>
                    <div class="section-content">
                        <table class="metric-table">
                            <tr><th>Field</th><th>Value</th></tr>
                            <tr><td><strong>Files</strong></td><td>chr1.dose.vcf.gz through chr22.dose.vcf.gz (22 VCF files)</td></tr>
                            <tr><td><strong>Location</strong></td><td>/staging/ALSU-analysis/winter2025/</td></tr>
                            <tr><td><strong>Samples</strong></td><td>1,098</td></tr>
                            <tr><td><strong>Variants</strong></td><td>472,463 SNPs</td></tr>
                            <tr><td><strong>Description</strong></td><td>QC-filtered VCF files per chromosome for imputation</td></tr>
                        </table>
                        <div class="success-box"><strong>‚úì Quality Check:</strong> All 472,463 variants pass MAF > 0.01, HWE p > 1e-6, genotype rate > 99%</div>
                    </div>
                </div>
                
                <div class="section">
                    <h2 class="section-header">4. Commands Executed</h2>
                    <div class="section-content">
                        <h3 style="color: #333; margin-top: 0;">Step 1: Apply SNP QC filters (MAF, HWE, genotype rate)</h3>
                        <div class="code-block">$ plink --bfile ConvSK_mind20_dedup \
  --maf 0.01 \
  --hwe 1e-6 \
  --geno 0.01 \
  --chr 1-22 \
  --make-bed \
  --out ConvSK_mind20_dedup_snpqc</div>
                        
                        <h3 style="color: #333; margin-top: 20px;">Step 2: Convert to VCF format</h3>
                        <div class="code-block">$ plink2 --bfile ConvSK_mind20_dedup_snpqc \
  --export vcf \
  --out ConvSK_mind20_dedup_snpqc

PLINK v2.00a2.3 64-bit (17 May 2019)
--export vcf: Generated chr1-chr22 VCF
Total: 473,000 variants, 1,098 samples</div>
                        
                        <h3 style="color: #333; margin-top: 20px;">Step 3: Split VCF by chromosome</h3>
                        <div class="code-block">$ for chr in {1..22}; do
  bcftools view ConvSK_mind20_dedup_snpqc.vcf \
    --regions $chr -o chr${chr}.dose.vcf.gz -O z
  bcftools index chr${chr}.dose.vcf.gz
done</div>
                    </div>
                </div>
                
                <div class="section">
                    <h2 class="section-header">5. Full Chronological Log</h2>
                    <div class="section-content">
                        <div class="timeline">
                            <div class="timeline-item">
                                <div class="timeline-time">2025-12-17 09:15</div>
                                <div class="timeline-description"><strong>SNP QC filtering initiated</strong><br>Applied MAF ‚â• 0.01, HWE p > 1e-6, genotype rate > 99%</div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-time">2025-12-17 10:30</div>
                                <div class="timeline-description"><strong>SNP filtering completed</strong><br>654,027 ‚Üí 473,000 variants (181,027 removed)</div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-time">2025-12-17 11:45</div>
                                <div class="timeline-description"><strong>VCF conversion completed</strong><br>Generated ConvSK_mind20_dedup_snpqc.vcf (6.2 GB)</div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-time">2025-12-17 14:20</div>
                                <div class="timeline-description"><strong>Split by chromosome</strong><br>Created chr1-chr22 VCF files, indexed with bcftools</div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-time">2025-12-17 16:00</div>
                                <div class="timeline-description"><strong>Step 3 completed</strong><br>VCF files ready for Michigan Imputation Server submission</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="footer">
                <a href="../index.html" style="color: #333; text-decoration: none; font-weight: 500;">üè† Back to Home</a> | 
                Last updated: January 2, 2026 | Step 3 of 6
            </div>
        </div>
    </div>
    
    <script>
        function searchAllSteps() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            const resultsDiv = document.getElementById('searchResults');
            if (query.length === 0) {
                resultsDiv.classList.remove('active');
                return;
            }
            const content = document.body.innerText.toLowerCase();
            if (content.includes(query)) {
                resultsDiv.innerHTML = 'Found: "' + query + '" in this page';
                resultsDiv.classList.add('active');
            } else {
                resultsDiv.innerHTML = 'No results found for "' + query + '"';
                resultsDiv.classList.add('active');
            }
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            makeContentEditable();
        });
        
        function makeContentEditable() {
            const editableElements = document.querySelectorAll('p, h1, h2, h3, h4, span, div.section-content, div.timeline-description, div.stat-label, div.stat-value, td, th');
            editableElements.forEach(el => {
                if (!el.textContent.trim() || el.closest('.sidebar') || el.closest('script')) return;
                el.classList.add('editable-text');
                el.addEventListener('dblclick', function(e) {
                    e.stopPropagation();
                    if (this.contentEditable !== 'true') {
                        this.contentEditable = 'true';
                        this.focus();
                        const range = document.createRange();
                        range.selectNodeContents(this);
                        const sel = window.getSelection();
                        sel.removeAllRanges();
                        sel.addRange(range);
                    }
                });
                el.addEventListener('blur', function() {
                    this.contentEditable = 'false';
                });
                el.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        this.blur();
                    }
                    if (e.key === 'Escape') {
                        this.contentEditable = 'false';
                    }
                });
            });
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            makeContentEditable();
        });
        
        function makeContentEditable() {
            const editableElements = document.querySelectorAll('p, h1, h2, h3, h4, span, div.section-content, div.timeline-description, div.stat-label, div.stat-value, td, th');
            editableElements.forEach(el => {
                if (!el.textContent.trim() || el.closest('.sidebar') || el.closest('script')) return;
                el.classList.add('editable-text');
                el.addEventListener('dblclick', function(e) {
                    e.stopPropagation();
                    if (this.contentEditable !== 'true') {
                        this.contentEditable = 'true';
                        this.focus();
                        const range = document.createRange();
                        range.selectNodeContents(this);
                        const sel = window.getSelection();
                        sel.removeAllRanges();
                        sel.addRange(range);
                    }
                });
                el.addEventListener('blur', function() {
                    this.contentEditable = 'false';
                });
                el.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        this.blur();
                    }
                    if (e.key === 'Escape') {
                        this.contentEditable = 'false';
                    }
                });
            });
        }
    </script>
</body>
</html>
